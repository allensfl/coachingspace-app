import{i as B,j as e,B as p,X as Te,v as U,d as K,m as C,e as y,f as k,g as D,h as S,T as q,w as Ae,k as M,r as u,x as Ee,F as H,C as X,y as Q,D as Fe,n as ze,o as $e,p as Pe,q as Ie,s as Ze,t as Ve,z as Be,A as He,E as Oe,H as Re,U as Je,L as _}from"./index-BCVF1PLb.js";import{T as _e,a as We,b as T,c as A}from"./tabs-D-qa9ZUa.js";import{A as Y,a as ee,b as se,c as ae,d as te,e as ie,f as le,g as ne,h as re}from"./alert-dialog-C4_CwsSl.js";import{S as Ue}from"./save-BLsd0mx1.js";import{L as ce}from"./link-CYnfH8i6.js";import{R as Ke,W as qe,I as Me,D as Xe,H as oe}from"./wrap-text-BzCOwKmv.js";import{V as Qe}from"./video-QN8leYHV.js";import{T as O}from"./trash-2-Doau15tD.js";import{I as L}from"./input-CMYn3E83.js";import{L as b}from"./label-gCXM_mwv.js";import{T as P}from"./textarea-Ei5qcXJt.js";import{U as de}from"./user-CaCbtgVu.js";import{C as Z}from"./checkbox-CLqVbJq_.js";import{C as Ye}from"./check-circle-DyRGt_RB.js";import{B as V}from"./badge-EtFkFwpi.js";import{T as es}from"./trophy-BWL3RJO3.js";import{S as W}from"./share-2-lsO2aeSV.js";import{T as ss}from"./TaskManager-Cw8suq0s.js";import{C as as}from"./clock-BzT5nvLL.js";import{A as ts}from"./arrow-left-BVjyKR_C.js";import{C as is}from"./clipboard-check-CysGfWXk.js";import{P as ls}from"./plus-circle-CsZ-giTn.js";import"./index-CTsaMBSn.js";import"./index-Cxa5liJK.js";import"./index-B8MATRhp.js";import"./check-C26bXOMj.js";import"./index-D9lbRThE.js";import"./floating-ui.react-dom-DMRTrF13.js";import"./calendar-CpAfWw-a.js";import"./de-B2K29ify.js";import"./isSameYear-DGw-2Tmo.js";import"./chevron-right-CVrpxHPZ.js";import"./chevron-left-B6OT_W-B.js";import"./select-B5ckg96L.js";import"./isToday-DmJ7ZUUg.js";function ns({coachee:a,isEditing:s,onEditToggle:t,onSave:o,onCancelEdit:n,onStartCoachingRoom:r,onDelete:f,onGeneratePortalLink:c}){var l,d;const{toast:h}=B(),G=()=>{var m,N;if(!((m=a.portalAccess)!=null&&m.initialToken)&&!((N=a.portalAccess)!=null&&N.permanentToken)){h({title:"Kein aktiver Link",description:"Bitte generieren Sie zuerst einen neuen Portal-Link.",variant:"destructive"});return}const j=`${window.location.origin}/portal/${a.portalAccess.initialToken||a.portalAccess.permanentToken}`;navigator.clipboard.writeText(j),h({title:"Link kopiert!",description:"Der Link zum Coachee-Portal wurde in die Zwischenablage kopiert.",className:"bg-green-600 text-white"})};return e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-white font-bold text-3xl",children:[(l=a.firstName)==null?void 0:l[0],(d=a.lastName)==null?void 0:d[0]]})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white",children:[a.firstName," ",a.lastName]}),e.jsx("p",{className:"text-slate-400",children:a.mainTopic})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:s?e.jsxs(e.Fragment,{children:[e.jsxs(p,{onClick:o,children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"})," Speichern"]}),e.jsxs(p,{variant:"outline",onClick:n,children:[e.jsx(Te,{className:"mr-2 h-4 w-4"})," Abbrechen"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(p,{variant:"outline",onClick:t,children:[e.jsx(U,{className:"mr-2 h-4 w-4"})," Bearbeiten"]}),e.jsxs("div",{className:"flex rounded-md border border-input",children:[e.jsxs(p,{variant:"outline",onClick:G,className:"rounded-r-none border-r-0",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"})," Portal-Link"]}),e.jsx(p,{variant:"outline",size:"icon",onClick:c,className:"rounded-l-none",children:e.jsx(Ke,{className:"h-4 w-4"})})]}),e.jsxs(p,{onClick:r,children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"})," Coaching Room"]}),e.jsxs(Y,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs(p,{variant:"destructive",children:[e.jsx(O,{className:"mr-2 h-4 w-4"})," L√∂schen"]})}),e.jsxs(se,{children:[e.jsxs(ae,{children:[e.jsx(te,{children:"Bist du absolut sicher?"}),e.jsx(ie,{children:"Diese Aktion kann nicht r√ºckg√§ngig gemacht werden. Dadurch wird der Coachee dauerhaft gel√∂scht und alle seine Daten entfernt."})]}),e.jsxs(le,{children:[e.jsx(ne,{children:"Abbrechen"}),e.jsx(re,{onClick:f,className:"bg-red-600 hover:bg-red-700",children:"Ja, Coachee l√∂schen"})]})]})]})]})})]})}const rs=({field:a,value:s,onChange:t,disabled:o})=>{const n={id:a.id,value:s||"",onChange:t,disabled:o,className:"mt-1"};switch(a.type){case"textarea":return e.jsx(P,{...n});case"date":return e.jsx(L,{type:"date",...n});case"number":return e.jsx(L,{type:"number",...n});case"text":default:return e.jsx(L,{type:"text",...n})}};function cs({coachee:a,isEditing:s,onChange:t,onCustomFieldChange:o}){const{state:n}=K(),{settings:r}=n,f=r.coacheeFields||[];return e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"md:col-span-1",children:e.jsxs(y,{className:"glass-card h-full",children:[e.jsx(k,{children:e.jsxs(D,{className:"text-white flex items-center",children:[e.jsx(de,{className:"mr-2 h-5 w-5"}),"Profilinformationen"]})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"firstName",children:"Vorname"}),e.jsx(L,{id:"firstName",value:a.firstName,onChange:t,disabled:!s})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"lastName",children:"Nachname"}),e.jsx(L,{id:"lastName",value:a.lastName,onChange:t,disabled:!s})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"email",children:"E-Mail"}),e.jsx(L,{id:"email",type:"email",value:a.email,onChange:t,disabled:!s})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"phone",children:"Telefon"}),e.jsx(L,{id:"phone",value:a.phone,onChange:t,disabled:!s})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"mainTopic",children:"Hauptthema"}),e.jsx(P,{id:"mainTopic",value:a.mainTopic,onChange:t,disabled:!s,rows:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{htmlFor:"confidentialNotes",className:"flex items-center gap-1",children:[e.jsx(qe,{className:"h-4 w-4"})," Vertrauliche Notizen (nur f√ºr dich)"]}),e.jsx(P,{id:"confidentialNotes",value:a.confidentialNotes,onChange:t,disabled:!s,rows:4,placeholder:"Diese Notizen sind privat und nur f√ºr dich sichtbar."})]}),f.length>0&&e.jsxs("div",{className:"pt-4 border-t border-slate-700 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Zus√§tzliche Informationen"}),f.map(c=>{var h;return e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:c.id,children:c.label}),e.jsx(rs,{field:c,value:(h=a.customData)==null?void 0:h[c.id],onChange:o,disabled:!s})]},c.id)})]})]})]})})}function os({coachee:a,isEditing:s,onConsentChange:t,onGenerateConsentLink:o}){return e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2},children:e.jsxs(y,{className:"glass-card",children:[e.jsx(k,{children:e.jsxs(D,{className:"text-white flex items-center",children:[e.jsx(Ye,{className:"mr-2 h-5 w-5"}),"Einwilligungen"]})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{id:"gdpr-consent",checked:a.consents.gdpr,onCheckedChange:n=>t("gdpr",n),disabled:!s}),e.jsx(b,{htmlFor:"gdpr-consent",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"DSGVO-Einwilligung"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{id:"audio-recording-consent",checked:a.consents.audioRecording,onCheckedChange:n=>t("audioRecording",n),disabled:!s}),e.jsx(b,{htmlFor:"audio-recording-consent",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Einwilligung zur Audioaufnahme"})]}),!a.consents.gdpr&&!s&&e.jsxs("div",{className:"pt-2",children:[e.jsxs("p",{className:"text-sm text-yellow-400 flex items-start",children:[e.jsx(Me,{className:"h-4 w-4 mr-2 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Wichtiger Hinweis: Ohne DSGVO-Einwilligung darf keine Coaching-Sitzung stattfinden."})]}),e.jsxs(p,{onClick:o,variant:"outline",size:"sm",className:"mt-3 w-full",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Consent-Link f√ºr Coachee generieren"]})]})]})]})})}function ds({coachee:a,isEditing:s,onToggleGoal:t,onDeleteGoal:o,onAddGoal:n,onEditGoal:r}){const f=()=>{const c={id:`new_${Date.now()}`,title:"Neues Ziel",description:"",subGoals:[],status:"In Progress"};r(c)};return e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1},children:e.jsxs(y,{className:"glass-card",children:[e.jsxs(k,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(D,{className:"text-primary flex items-center",children:[e.jsx(q,{className:"mr-2 h-5 w-5"}),"Ziele"]}),e.jsx(Ae,{children:"Verfolge die Haupt- und Teilziele deines Coachees."})]}),s&&e.jsxs(p,{variant:"outline",onClick:f,children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Ziel hinzuf√ºgen"]})]}),e.jsx(S,{className:"space-y-4",children:a.goals&&a.goals.length>0?a.goals.map(c=>e.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/50 group",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white",children:c.title}),e.jsx("p",{className:"text-sm text-slate-400",children:c.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c.subGoals.every(h=>h.completed)&&e.jsxs(V,{className:"bg-green-500/20 text-green-300 border-green-500/30 hidden sm:flex items-center",children:[e.jsx(es,{className:"mr-2 h-4 w-4"}),"Erreicht!"]}),s&&e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>r(c),children:e.jsx(U,{className:"h-4 w-4"})}),e.jsxs(Y,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",children:e.jsx(O,{className:"h-4 w-4 text-red-500"})})}),e.jsxs(se,{children:[e.jsxs(ae,{children:[e.jsx(te,{children:"Bist du sicher?"}),e.jsx(ie,{children:"Diese Aktion kann nicht r√ºckg√§ngig gemacht werden. Das Ziel wird dauerhaft gel√∂scht."})]}),e.jsxs(le,{children:[e.jsx(ne,{children:"Abbrechen"}),e.jsx(re,{onClick:()=>o(c.id),className:"bg-red-600 hover:bg-red-700",children:"L√∂schen"})]})]})]})]})]})]}),e.jsx("div",{className:"mt-3 space-y-2",children:c.subGoals.map(h=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-slate-700/50",children:[e.jsx(Z,{id:`subgoal-${h.id}`,checked:h.completed,onCheckedChange:()=>s&&t(c.id,h.id),disabled:!s}),e.jsx("label",{htmlFor:`subgoal-${h.id}`,className:`flex-1 text-sm ${h.completed?"line-through text-slate-500":"text-slate-300"}`,children:h.title})]},h.id))})]},c.id)):e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Keine Ziele definiert."})})]})})}const ms=({coachee:a})=>{const[s,t]=u.useState({journalEntries:[],documents:[]});u.useEffect(()=>{var r,f;if(a)try{const c=localStorage.getItem(`coacheePortalData_${a.id}`);if(c){const h=JSON.parse(c),G=((r=h.journalEntries)==null?void 0:r.filter(d=>d.shared))||[],l=((f=h.documents)==null?void 0:f.filter(d=>d.shared))||[];t({journalEntries:G,documents:l})}}catch(c){console.error("Failed to parse portal data from localStorage",c)}},[a]);const o=s&&s.journalEntries.length>0,n=s&&s.documents.length>0;return!o&&!n?e.jsxs(y,{className:"glass-card",children:[e.jsx(k,{children:e.jsxs(D,{className:"text-white flex items-center gap-2",children:[e.jsx(W,{})," Vom Coachee geteilt"]})}),e.jsx(S,{children:e.jsx("p",{className:"text-slate-400 text-center py-4",children:"Der Coachee hat noch keine Inhalte aus dem Portal geteilt."})})]}):e.jsxs(y,{className:"glass-card",children:[e.jsx(k,{children:e.jsxs(D,{className:"text-white flex items-center gap-2",children:[e.jsx(W,{})," Vom Coachee geteilt"]})}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-4 max-h-72 overflow-y-auto pr-2",children:[o&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-300 mb-2",children:"Journal-Eintr√§ge"}),e.jsx("ul",{className:"space-y-2",children:s.journalEntries.map(r=>e.jsxs("li",{className:"p-3 bg-slate-800/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsxs("p",{className:"font-semibold text-slate-200 flex items-center gap-2 text-sm",children:[e.jsx(Ee,{className:"h-4 w-4 text-primary"}),"Eintrag vom ",new Date(r.date).toLocaleDateString("de-DE")]}),e.jsx(V,{variant:"outline",children:new Date(r.date).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:"text-sm text-slate-400 pl-6 whitespace-pre-wrap",children:r.content})]},r.id))})]}),n&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-300 mb-2 pt-4",children:"Dokumente"}),e.jsx("ul",{className:"space-y-2",children:s.documents.map(r=>e.jsx("li",{className:"p-3 bg-slate-800/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"font-semibold text-slate-200 flex items-center gap-2 text-sm",children:[e.jsx(H,{className:"h-4 w-4 text-primary"}),r.name]}),e.jsx(V,{variant:"secondary",children:r.size})]})},r.id))})]})]})})]})},z=a=>{if(!a)return"N/A";const s=new Date(a);return isNaN(s)?"N/A":new Intl.DateTimeFormat("de-DE",{dateStyle:"medium",timeStyle:"short"}).format(s)},$=({icon:a,title:s,items:t,children:o,delay:n})=>{const{toast:r}=B();return e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:n},children:e.jsxs(y,{className:"glass-card h-full flex flex-col",children:[e.jsx(k,{children:e.jsxs(D,{className:"text-primary flex items-center",children:[e.jsx(a,{className:"mr-2 h-5 w-5"}),s]})}),e.jsx(S,{className:"space-y-2 flex-1",children:t&&t.length>0?e.jsxs(e.Fragment,{children:[t.slice(0,3).map(o),t.length>3&&e.jsxs("p",{className:"text-muted-foreground text-sm",children:["+ ",t.length-3," weitere"]})]}):e.jsx("p",{className:"text-muted-foreground text-sm",children:"Keine Eintr√§ge erfasst."})}),e.jsx("div",{className:"p-6 pt-0",children:e.jsxs(p,{variant:"outline",className:"w-full mt-2",onClick:()=>r({title:"üöß Diese Funktion ist noch nicht implementiert",description:"Du kannst sie in deinem n√§chsten Prompt anfordern! üöÄ"}),children:["Alle ",s]})})]})})};function hs({coachee:a}){return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:[e.jsx($,{icon:X,title:"Sitzungen",items:a.sessions,delay:.3,children:s=>e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.topic}),e.jsx("p",{className:"text-sm text-muted-foreground",children:z(s.date)})]},s.id)}),e.jsx($,{icon:Q,title:"Journal",items:a.journalEntries,delay:.4,children:s=>e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:z(s.date)})]},s.id)}),e.jsx($,{icon:Xe,title:"Rechnungen",items:a.invoices,delay:.5,children:s=>e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Rechnung #",s.id]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[z(s.date)," - ",s.amount," ",s.currency]})]},s.id)}),e.jsx($,{icon:H,title:"Dokumente",items:a.documents,delay:.6,children:s=>e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[z(s.uploadDate)," - ",s.format]})]},s.id)})]})}const xs=({auditLog:a})=>{const s=[...a||[]].sort((t,o)=>new Date(o.timestamp)-new Date(t.timestamp));return e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(y,{className:"glass-card",children:[e.jsx(k,{children:e.jsxs(D,{className:"text-white flex items-center",children:[e.jsx(oe,{className:"mr-2 h-5 w-5"}),"Audit Log / Verlauf"]})}),e.jsx(S,{children:e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto pr-2",children:s.length>0?s.map((t,o)=>e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-slate-700 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(de,{className:"h-5 w-5 text-slate-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-200",children:t.action}),e.jsxs("div",{className:"text-xs text-slate-500 flex items-center gap-2 mt-1",children:[e.jsx(as,{className:"h-3 w-3"}),e.jsx("span",{children:new Date(t.timestamp).toLocaleString("de-DE")}),e.jsxs("span",{children:["durch ",t.user]})]})]})]},o)):e.jsx("p",{className:"text-slate-400 text-center py-4",children:"Keine Verlaufseintr√§ge vorhanden."})})})]})})},us=({goal:a,isOpen:s,onOpenChange:t,onSave:o})=>{const[n,r]=u.useState(a);if(u.useEffect(()=>{r(a)},[a]),!n)return null;const f=(d,j)=>{r(m=>({...m,[d]:j}))},c=(d,j)=>{const m=[...n.subGoals];m[d]={...m[d],title:j},r(N=>({...N,subGoals:m}))},h=()=>{r(d=>({...d,subGoals:[...d.subGoals,{id:`sg_${Date.now()}`,title:"",completed:!1}]}))},G=d=>{const j=n.subGoals.filter((m,N)=>N!==d);r(m=>({...m,subGoals:j}))},l=()=>{o(n),t(!1)};return e.jsx(Fe,{open:s,onOpenChange:t,children:e.jsxs(ze,{className:"sm:max-w-[525px] glass-card",children:[e.jsxs($e,{children:[e.jsx(Pe,{children:n.id.startsWith("new_")?"Neues Ziel hinzuf√ºgen":"Ziel bearbeiten"}),e.jsx(Ie,{children:"Definiere das Hauptziel und die dazugeh√∂rigen Sub-Ziele."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"goal-title",children:"Titel des Ziels"}),e.jsx(L,{id:"goal-title",placeholder:"Titel des Ziels",value:n.title,onChange:d=>f("title",d.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"goal-description",children:"Beschreibung"}),e.jsx(P,{id:"goal-description",placeholder:"Beschreibung",value:n.description,onChange:d=>f("description",d.target.value)})]}),e.jsx("h4",{className:"font-semibold text-sm pt-2",children:"Sub-Ziele"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto pr-2",children:n.subGoals.map((d,j)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{placeholder:`Sub-Ziel ${j+1}`,value:d.title,onChange:m=>c(j,m.target.value),className:"flex-grow"}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>G(j),children:e.jsx(O,{className:"h-4 w-4 text-red-500"})})]},j))}),e.jsxs(p,{variant:"outline",onClick:h,children:[e.jsx(M,{className:"mr-2 h-4 w-4"})," Sub-Ziel hinzuf√ºgen"]})]}),e.jsxs(Ze,{children:[e.jsx(Ve,{asChild:!0,children:e.jsx(p,{variant:"secondary",children:"Abbrechen"})}),e.jsx(p,{onClick:l,children:"Speichern"})]})]})})},Ms=()=>{const{id:a}=Be(),s=He(),{toast:t}=B(),{state:o,actions:n}=K(),{getCoacheeById:r,updateCoachee:f,ensurePermanentTokenForDemo:c,setCoachees:h}=n,{sessionNotes:G}=o,[l,d]=u.useState(null),[j,m]=u.useState(null),[N,I]=u.useState(!1),[me,he]=u.useState(!0),[xe,R]=u.useState(!1),[J,ue]=u.useState(null);u.useEffect(()=>{if(o.isLoading)return;const i=r(a);i?(d(i),he(!1)):(t({title:"Fehler",description:"Coachee nicht gefunden.",variant:"destructive"}),s("/coachees"))},[a,r,s,t,o.isLoading,o.coachees]);const je=u.useCallback(()=>{m(N?null:{...l,customData:l.customData||{}}),I(i=>!i)},[N,l]),pe=()=>{m(null),I(!1)},ge=u.useCallback(()=>{if(!j)return;const i={...j,auditLog:[...j.auditLog||[],{timestamp:new Date().toISOString(),user:"Coach",action:"Coachee-Daten aktualisiert"}]};f(i),d(i),I(!1),m(null),t({title:"Erfolgreich",description:"Coachee-Daten aktualisiert."})},[j,f,t]),fe=u.useCallback(i=>{const{id:x,value:g}=i.target;m(v=>({...v,[x]:g}))},[]),Ne=u.useCallback(i=>{const{id:x,value:g}=i.target;m(v=>({...v,customData:{...v.customData,[x]:g}}))},[]),we=u.useCallback((i,x)=>{m(g=>({...g,consents:{...g.consents,[i]:x}}))},[]),be=u.useCallback((i,x)=>{m(g=>{const v=g.goals.map(w=>{if(w.id===i){const Ge=w.subGoals.map(F=>F.id===x?{...F,completed:!F.completed}:F);return{...w,subGoals:Ge}}return w});return{...g,goals:v}})},[]),ve=i=>{ue(i),R(!0)},Ce=u.useCallback(i=>{m(x=>({...x,goals:x.goals.filter(g=>g.id!==i)}))},[]),ye=i=>{const x=j.goals||[];let g,v="";if(i.id.startsWith("new_")){const w={...i,id:`g_${Date.now()}`};g=[...x,w],v=`Neues Ziel hinzugef√ºgt: "${w.title}"`}else g=x.map(w=>w.id===i.id?i:w),v=`Ziel bearbeitet: "${i.title}"`;m(w=>({...w,goals:g,auditLog:[...w.auditLog||[],{timestamp:new Date().toISOString(),user:"Coach",action:v}]}))},ke=()=>{h(i=>i.filter(x=>x.id!==parseInt(a))),t({title:"Coachee gel√∂scht",description:`${l.firstName} ${l.lastName} wurde entfernt.`,variant:"destructive"}),s("/coachees")},De=u.useCallback(()=>{if(!l)return;const i=c(l),x=`${window.location.origin}/portal/${i}`;navigator.clipboard.writeText(x),t({title:"Portal-Link kopiert",description:"Der permanente Portal-Link wurde in die Zwischenablage kopiert."})},[l,c,t]),Se=u.useCallback(()=>{if(!l)return;const i=`${window.location.origin}/consent/${l.id}`;navigator.clipboard.writeText(i),t({title:"DSGVO Consent-Link kopiert",description:"Der Link wurde in die Zwischenablage kopiert. Senden Sie ihn an Ihren Coachee."})},[l,t]),Le=()=>{s(`/coaching-room/${a}`)};if(me||!l)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-slate-950 text-white p-4",children:[e.jsx(Oe,{className:"h-12 w-12 animate-spin text-primary mb-4"}),e.jsx("p",{className:"text-lg text-slate-400",children:"Coachee-Daten werden geladen..."})]});const E=N?j:l;return e.jsxs(e.Fragment,{children:[e.jsxs(Re,{children:[e.jsxs("title",{children:[l.firstName," ",l.lastName," - Coachingspace"]}),e.jsx("meta",{name:"description",content:`Details und Verwaltung f√ºr Coachee ${l.firstName} ${l.lastName}.`})]}),J&&e.jsx(us,{goal:J,isOpen:xe,onOpenChange:R,onSave:ye}),e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-8 pt-6",children:[e.jsx(C.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex items-center justify-between space-y-2",children:e.jsxs(p,{variant:"ghost",onClick:()=>s("/coachees"),className:"text-slate-400 hover:text-white",children:[e.jsx(ts,{className:"mr-2 h-4 w-4"})," Zur√ºck zu Coachees"]})}),e.jsx(ns,{coachee:E,isEditing:N,onEditToggle:je,onSave:ge,onCancelEdit:pe,onStartCoachingRoom:Le,onDelete:ke,onGeneratePortalLink:De}),e.jsx(hs,{coachee:l}),e.jsxs(_e,{defaultValue:"profile",className:"mt-6",children:[e.jsxs(We,{className:"grid w-full grid-cols-2 sm:grid-cols-3 md:grid-cols-6",children:[e.jsxs(T,{value:"profile",children:[e.jsx(Je,{className:"mr-2 h-4 w-4"})," Profil"]}),e.jsxs(T,{value:"goals",children:[e.jsx(q,{className:"mr-2 h-4 w-4"})," Ziele"]}),e.jsxs(T,{value:"tasks",children:[e.jsx(is,{className:"mr-2 h-4 w-4"})," Aufgaben"]}),e.jsxs(T,{value:"sessions",children:[e.jsx(X,{className:"mr-2 h-4 w-4"})," Sessions"]}),e.jsxs(T,{value:"journal",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"})," Journal"]}),e.jsxs(T,{value:"history",children:[e.jsx(oe,{className:"mr-2 h-4 w-4"})," Verlauf"]})]}),e.jsx(A,{value:"profile",className:"mt-6",children:e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx(cs,{coachee:E,isEditing:N,onFieldChange:fe,onCustomFieldChange:Ne}),e.jsx(os,{coachee:E,isEditing:N,onConsentChange:we,onGenerateConsentLink:Se}),e.jsx(ms,{coachee:l})]})})}),e.jsx(A,{value:"goals",className:"mt-6",children:e.jsx(ds,{coachee:E,isEditing:N,onToggleGoal:be,onDeleteGoal:Ce,onEditGoal:ve})}),e.jsx(A,{value:"tasks",className:"mt-6",children:e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(y,{className:"glass-card",children:[e.jsx(k,{children:e.jsxs(D,{children:["Aufgaben f√ºr ",l.firstName]})}),e.jsx(S,{children:e.jsx(ss,{coacheeId:l.id})})]})})}),e.jsx(A,{value:"sessions",className:"mt-6",children:e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(y,{className:"glass-card",children:[e.jsx(k,{children:e.jsx(D,{children:"Alle Sessions"})}),e.jsx(S,{children:l.sessions&&l.sessions.length>0?e.jsx("ul",{className:"space-y-4",children:l.sessions.map(i=>{const x=(G||[]).find(g=>g.sessionId===i.id);return e.jsxs("li",{className:"flex justify-between items-center text-slate-300 p-3 bg-slate-800/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:i.topic}),e.jsx("p",{className:"text-sm text-slate-400",children:new Date(i.date).toLocaleDateString("de-DE",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),x?e.jsx(p,{asChild:!0,variant:"outline",size:"sm",children:e.jsxs(_,{to:`/session-notes/${x.id}`,children:[e.jsx(H,{className:"mr-2 h-4 w-4"})," Notiz ansehen"]})}):e.jsx(p,{asChild:!0,variant:"secondary",size:"sm",children:e.jsxs(_,{to:`/session-notes/new?sessionId=${i.id}&coacheeId=${l.id}`,children:[e.jsx(ls,{className:"mr-2 h-4 w-4"})," Notiz erstellen"]})})]},i.id)})}):e.jsx("p",{className:"text-slate-400 text-center py-4",children:"Noch keine Sessions mit diesem Coachee."})})]})})}),e.jsx(A,{value:"journal",className:"mt-6",children:e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(y,{className:"glass-card",children:[e.jsx(k,{children:e.jsx(D,{children:"Journal-Eintr√§ge"})}),e.jsx(S,{children:l.journalEntries&&l.journalEntries.length>0?e.jsx("ul",{className:"space-y-3",children:l.journalEntries.map(i=>e.jsxs("li",{className:"flex justify-between items-center text-slate-300",children:[e.jsx("span",{children:i.title}),e.jsx("span",{className:"text-sm text-slate-400",children:new Date(i.date).toLocaleDateString("de-DE")})]},i.id))}):e.jsx("p",{className:"text-slate-400 text-center py-4",children:"Noch keine Journal-Eintr√§ge f√ºr diesen Coachee."})})]})})}),e.jsx(A,{value:"history",className:"mt-6",children:e.jsx(xs,{auditLog:E.auditLog})})]})]})]})};export{Ms as default};
